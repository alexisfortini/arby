{% extends "base.html" %}

{% block content %}

<div class="max-w-2xl mx-auto">
    <div class="mb-4">
        <a href="/library" class="text-slate-500 hover:text-slate-800 text-sm">‚Üê Cancel</a>
    </div>

    <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6 md:p-8">
        <h1 class="text-2xl font-bold text-slate-800 mb-6">
            {% if recipe %}Edit Recipe{% else %}Add New Recipe{% endif %}
        </h1>

        <form method="POST">
            <div class="space-y-6">
                <!-- Name -->
                <div>
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Recipe Name</label>
                    <input type="text" name="name" value="{{ recipe.name if recipe else request.args.get('name', '') }}"
                        required
                        class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500">
                </div>

                <!-- Category & Source -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-2">Category</label>
                        <select name="category"
                            class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500">
                            {% for cat in categories %}
                            <option value="{{ cat }}" {% if recipe and recipe.category==cat %}selected{% endif %}>
                                {{ cat }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-2">Recipe Source</label>
                        <select name="source"
                            class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500">
                            <option value="chef" {% if recipe and recipe.source=='chef' or (recipe and
                                recipe.source=='arby' ) %}selected{% endif %}>Chef's (Arby)</option>
                            <option value="user" {% if (recipe and recipe.source=='user' ) or (recipe and
                                recipe.source=='manual' ) or not recipe %}selected{% endif %}>User (Manual)</option>
                            <option value="pdf" {% if recipe and recipe.source=='pdf' %}selected{% endif %}>PDF
                                (Imported)</option>
                        </select>
                    </div>
                </div>

                <!-- Protein -->
                <div class="grid grid-cols-1 gap-6">
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-2">Protein / Diet</label>
                        <input type="text" name="protein" list="protein-list"
                            value="{{ recipe.protein if recipe else '' }}" placeholder="e.g. Chicken, Beef, Keto..."
                            class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500">
                        <datalist id="protein-list">
                            {% for prot in proteins %}
                            <option value="{{ prot }}">
                                {% endfor %}
                        </datalist>
                    </div>
                </div>

                <!-- Ingredients -->
                <div>
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Ingredients (one per line)</label>
                    <textarea name="ingredients" rows="6" required
                        class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500 font-mono text-sm">{% if recipe %}{{ recipe.ingredients | join('\n') }}{% endif %}</textarea>
                </div>

                <!-- Instructions -->
                <div>
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Instructions (one per line)</label>
                    <textarea name="instructions" rows="6" required
                        class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500 font-mono text-sm">{% if recipe %}{{ recipe.instructions | join('\n') }}{% endif %}</textarea>
                </div>

                <div class="pt-4 flex justify-end">
                    <button type="submit"
                        class="bg-green-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-green-700 transition shadow-lg shadow-green-200">
                        Save Recipe
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

{% endblock %}