{% extends "base.html" %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="text-center py-4">
        <h1 class="text-3xl font-bold text-slate-800 mb-2">Recipe Ideas</h1>
        <p class="text-slate-500">Guide the Head Chef's creativity for your upcoming plans.</p>
    </div>

    <!-- Main Form Card -->
    <div class="bg-white rounded-3xl p-6 border border-slate-100 shadow-sm space-y-4">
        <p class="text-sm text-slate-500 leading-relaxed font-medium">
            What are you in the mood for? Tell Arby about your cravings, dietary needs for the week, or specific recipes
            you want to see.
        </p>

        <textarea id="ideasText" rows="12"
            class="w-full bg-slate-50 border border-slate-200 rounded-2xl px-5 py-4 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm text-slate-700 font-medium placeholder-slate-400"
            placeholder="e.g. 'Healthy Mediterranean meals', 'Lots of soups', 'Use that Salmon recipe from the library'...">{{ current_ideas }}</textarea>

        <div class="flex justify-between items-center pt-2">
            <button onclick="clearIdeas()"
                class="px-5 py-3 text-slate-400 font-bold hover:text-red-500 transition-colors flex items-center gap-2">
                <span>Clear All</span>
                <span>üóëÔ∏è</span>
            </button>
            <button onclick="saveIdeas()" id="saveIdeasBtn"
                class="px-8 py-3 bg-purple-600 text-white font-bold rounded-xl shadow-lg shadow-purple-200 hover:bg-purple-700 hover:scale-[1.02] active:scale-[0.98] transition-all flex items-center gap-2">
                <span>Save My Ideas</span>
                <span>‚ú®</span>
            </button>
        </div>
    </div>
</div>

<script>
    function clearIdeas() {
        if (confirm("Are you sure you want to clear all your recipe ideas?")) {
            document.getElementById('ideasText').value = '';
            saveIdeas();
        }
    }

    function saveIdeas() {
        const text = document.getElementById('ideasText').value;
        const btn = document.getElementById('saveIdeasBtn');
        const originalText = btn.innerHTML;

        btn.innerHTML = '<span class="animate-pulse">Saving...</span>';
        btn.disabled = true;

        fetch('/api/ideas', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ ideas: text })
        })
            .then(r => r.json())
            .then(data => {
                if (data.status === 'ok') {
                    btn.innerHTML = '<span>Saved!</span><span>‚úÖ</span>';
                    btn.classList.remove('bg-purple-600');
                    btn.classList.add('bg-green-600');
                    setTimeout(() => {
                        btn.innerHTML = originalText;
                        btn.classList.remove('bg-green-600');
                        btn.classList.add('bg-purple-600');
                        btn.disabled = false;
                    }, 2000);
                }
            })
            .catch(err => {
                console.error(err);
                btn.innerHTML = originalText;
                btn.disabled = false;
                alert("Failed to save. Check server logs.");
            });
    }
</script>
{% endblock %}